<!DOCTYPE html>
<html lang="en">

    <head>
        <title>CodeMe; Our Developers</title>
        <meta charset="utf-8">
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
            rel="stylesheet">
        <link rel="stylesheet" href="/developersOption.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    </head>

    <body>
        <div class="jumbotron" id="header">
            <div class="container text-center">
                <h1>CodeMe;</h1>
                <p>Connect Between People to Code</p>
            </div>
        </div>

        <div class="text-center">
            <div class="btn-group">
                <button type="button" class="btn btn-primary" id="createBtn">Create New Developer</button>
                <button type="button" class="btn btn-primary">Update Your Profile</button>
                <button type="button" class="btn btn-primary">Remove Your Profile</button>
            </div>
        </div>

        <br>
        <div class="form-outline mb-4">
            <input
                type="search"
                class="form-control"
                id="datatable-search-input"
                placeholder="Search">
        </div>

        <br><br>

        <section style="background-color: #eee;">
            <div class="text-center container py-5">
                <h4 class="mt-4 mb-5">
                    <strong>Our Developers</strong>
                </h4>

                <div class="row">
                    <%for (var i=0; i < developers.length; i++) {%>
                    <div class="col-lg-4 col-md-12 mb-4 devs">
                        <div class="card clickableDivs" id="<%=developers[i].id%>">
                            <div
                                class="bg-image hover-zoom ripple ripple-surface ripple-surface-light"
                                data-mdb-ripple-color="light">
                                <img
                                src="data:developers[i]/<%=developers[i].picture%>;base64,
                  <%=developers[i].picture%>"
                                class="img-responsive"
                                style="width:  80px; height: 80px;
                                object-fit: cover; border-radius: 50%;">
                                    <div class="mask">
                                        <div class="d-flex justify-content-start align-items-end h-100">
                                        </div>
                                    </div>
                                    <div class="hover-overlay">
                                        <div class="mask" style="background-color: rgba(251, 251, 251, 0.15);"></div>
                                    </div>
                                </a>
                            </div>
                            <div class="card-body">
                                <a href="" class="text-reset">
                                    <h5 class="card-title mb-3"><%=developers[i].name%></h5>
                                </a>
                                <a href="" class="text-reset">
                                    <p><%=developers[i].langs%></p>
                                </a>
                                <h6 class="mb-3">TBD</h6>
                            </div>
                        </div>
                    </div>
                    <%}%>
                </div>
            </div>
        </section>
<br><br>

        <div id="map"></div>

        <footer class="container-fluid text-center">
            <p>CodeMe;</p>
        </footer>

        <script id='mapScript' async="async" defer="defer"></script>
        <script>

            var infobox,
                map;
            var APIKEY = '<%= process.env.API_KEY %>';
            var url = "https://www.bing.com/api/maps/mapcontrol?key=" + APIKEY + "&callback" +
                    "=loadMapScenario";
            document
                .getElementById('mapScript')
                .src = url;

            function loadMapScenario() {
                map = new Microsoft
                    .Maps
                    .Map(document.getElementById('map'), {});
                infobox = new Microsoft
                    .Maps
                    .Infobox(map.getCenter(), {visible: false});
                infobox.setMap(map);

                Microsoft
                    .Maps
                    .loadModule('Microsoft.Maps.Search', function () {
                        var searchManager = new Microsoft
                            .Maps
                            .Search
                            .SearchManager(map);

                        "<% for (var i = 0; i < developers.length; i++) { %>"
                        var requestOptions = {
                            bounds: map.getBounds(),
                            where: "<%=developers[i].city%>",
                            callback: function (answer, userData) {
                                map.setView({
                                    bounds: answer
                                        .results[0]
                                        .bestView
                                });

                                var pin = new Microsoft
                                    .Maps
                                    .Pushpin(answer.results[0].location);
                                pin.metadata = {
                                    title: "<%=developers[i].city%>",
                                    description: "<%=developers[i].id%>"
                                };

                                Microsoft
                                    .Maps
                                    .Events
                                    .addHandler(pin, 'click', pushpinClick);

                                Microsoft
                                    .Maps
                                    .Events
                                    .addHandler(pin, 'mouseover', pushpinOver);

                                map
                                    .entities
                                    .push(pin);

                            }
                        };
                        searchManager.geocode(requestOptions);
                        "<%}%>"
                    });

            }

            function pushpinOver(e) {
                //Make sure the infobox has metadata to display.
                if (e.target.metadata) {
                    //Set the infobox options with the metadata of the pushpin.
                    infobox.setOptions({
                        location: e
                            .target
                            .getLocation(),
                        title: e.target.metadata.title,
                        visible: true
                    });
                }
            }

            function pushpinClick(e) {
                var id = e.target.metadata.description;
                console.log(id);
                console.log("You clicked element #" + e.target.metadata.description);
                window.open(
                    "./developerProfile/?id=" + id,
                    "_blank",
                    "toolbar=yes,scrollbars=yes,resizable=yes,top=200,left=200,width=800,height=800"
                );
            }
        </script>

        <script src="/developersOption.js"></script>
    </body>

</html>