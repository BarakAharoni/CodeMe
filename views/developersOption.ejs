<!DOCTYPE html>
<html lang="en">

    <head>
        <title>CodeMe; Our Developers</title>
        <meta charset="utf-8">
        <link rel="icon" href="/icon.jpg">
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
            rel="stylesheet">
        <link rel="stylesheet" href="/developersOption.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    </head>

    <body>
        <div class="jumbotron" id="header">
            <div class="container text-center">
                <h1>CodeMe;</h1>
                <p>Connect Between People to Code</p>
            </div>
        </div>

        <nav class="navbar navbar-expand-sm bg-light navbar-light">
            <div class="container-fluid">

                <ul class="navbar-nav">
                    <li class="navbar-brand">
                        <a href="/developers">
                            <img src="/logo.jfif" id="logo">
                        </a>
                    </li>
                    <li class="nav-item">
                        <button type="button" class="btn" id="createBtn">Create New Developer</button>
                    </li>
                    <li class="nav-item">
                        <button type="button" class="btn">Update Your Profile</button>
                    </li>
                    <li class="nav-item">
                        <button type="button" class="btn">Remove Your Profile</button>
                    </li>
                </ul>
                <form class="d-flex">
                    <input
                        type="search"
                        class="form-control"
                        id="datatable-search-input"
                        placeholder="Search">
                </form>
            </div>
        </nav>
        
        <section style="background-color: #eee;">
            <div class="text-center container py-5">
                <h4 class="mt-4 mb-5">
                    <strong>Our Developers</strong>
                </h4>

                <div class="row">
                    <%for (var i=0; i < developers.length; i++) {%>
                        <div class="col-lg-4 col-md-12 mb-4 devs">
                            <div class="card clickableDivs" id="<%=developers[i].id%>">
                                <div
                                    class="bg-image hover-zoom ripple ripple-surface ripple-surface-light"
                                    data-mdb-ripple-color="light">
                                    <img
                                        src="data:developers[i]/<%=developers[i].picture%>;base64,
                  <%=developers[i].picture%>"
                                        class="img-responsive"
                                        style="width:  80px; height: 80px;
                                object-fit: cover; border-radius: 50%;">
                                    <div class="mask">
                                        <div class="d-flex justify-content-start align-items-end h-100"></div>
                                    </div>
                                    <div class="hover-overlay">
                                        <div class="mask" style="background-color: rgba(251, 251, 251, 0.15);"></div>
                                    </div>
                                </a>
                            </div>
                            <div class="card-body">
                                <a href="" class="text-reset">
                                    <h5 class="card-title mb-3"><%=developers[i].name%></h5>
                                </a>
                                <a href="" class="text-reset">
                                    <p><%=developers[i].langs%></p>
                                </a>
                                <h6 class="mb-3">TBD</h6>
                            </div>
                            <button type="button" class="btn btn-outline-dark addcomment" id="comment<%=developers[i]._id%>" value="<%=developers[i]._id%>">add comment</button>
                            <button type="button" class="btn btn-outline-dark viewcomments" id="view<%=developers[i]._id%>" value="<%=developers[i]._id%>">view comments</button>
                            <button type="button" class="btn btn-outline-dark chat" id="shared<%=developers[i]._id%>" value="<%=developers[i]._id%>">enter chat</button>
                        </div>
                    </div>
                <%}%>
            </div>
        </div>
    </section>
    <br><br>

    <div id="map"></div>

    <footer class="text-center text-lg-start bg-light text-muted">
        <section class="">
            <div class="container text-center text-md-start mt-5">

                <div class="row mt-3">
                    <div class="col-md-3 col-lg-4 col-xl-3 mx-auto mb-4">
                        <h6 class="text-uppercase fw-bold mb-4">
                            <i class="fas fa-gem me-3"></i>CODEME;
                        </h6>
                        <p>
                            We are a platform designed to create a connection between code and people, thus
                            making the most advanced technology accessible to everyone, from anywhere.
                        </p>
                    </div>

                    <div class="col-md-2 col-lg-2 col-xl-2 mx-auto mb-4">
                        <h6 class="text-uppercase fw-bold mb-4">
                            Who We Are?
                        </h6>

                        <video width="320" height="240" controls>
                            <source src="/whoWeAre.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>

                    </div>

                    <div class="col-md-4 col-lg-3 col-xl-3 mx-auto mb-md-0 mb-4">
                        <!-- Links -->
                        <h6 class="text-uppercase fw-bold mb-4">Contact</h6>
                        <p>
                            The College of Management Academic Studies, Rishon LeZion</p>
                        <p>
                            info@example.com
                        </p>
                    </div>
                    <!-- Grid column -->
                </div>
                <!-- Grid row -->
            </div>
        </section>
        <!-- Section: Links -->

        <!-- Copyright -->
        <div class="text-center p-4" style="background-color: rgba(0, 0, 0, 0.05);">
            Â© CodeMe;
        </div>
    </footer>

    <script id='mapScript' async="async" defer="defer"></script>
    <script>

        var infobox,
            map;
        var APIKEY = '<%= process.env.API_KEY %>';
        var url = "https://www.bing.com/api/maps/mapcontrol?key=" + APIKEY + "&callback" +
                "=loadMapScenario";
        document
            .getElementById('mapScript')
            .src = url;

        function loadMapScenario() {
            map = new Microsoft
                .Maps
                .Map(document.getElementById('map'), {});
            infobox = new Microsoft
                .Maps
                .Infobox(map.getCenter(), {visible: false});
            infobox.setMap(map);

            Microsoft
                .Maps
                .loadModule('Microsoft.Maps.Search', function () {
                    var searchManager = new Microsoft
                        .Maps
                        .Search
                        .SearchManager(map);

                    "<% for (var i = 0; i < developers.length; i++) { %>"
                    var requestOptions = {
                        bounds: map.getBounds(),
                        where: "<%=developers[i].city%>",
                        callback: function (answer, userData) {
                            map.setView({
                                bounds: answer
                                    .results[0]
                                    .bestView
                            });

                            var pin = new Microsoft
                                .Maps
                                .Pushpin(answer.results[0].location);
                            pin.metadata = {
                                title: "<%=developers[i].city%>",
                                description: "<%=developers[i].id%>"
                            };

                            Microsoft
                                .Maps
                                .Events
                                .addHandler(pin, 'click', pushpinClick);

                            Microsoft
                                .Maps
                                .Events
                                .addHandler(pin, 'mouseover', pushpinOver);

                            map
                                .entities
                                .push(pin);

                        }
                    };
                    searchManager.geocode(requestOptions);
                    "<%}%>"
                });

        }

        function pushpinOver(e) {
            //Make sure the infobox has metadata to display.
            if (e.target.metadata) {
                //Set the infobox options with the metadata of the pushpin.
                infobox.setOptions({
                    location: e
                        .target
                        .getLocation(),
                    title: e.target.metadata.title,
                    visible: true
                });
            }
        }

        function pushpinClick(e) {
            var id = e.target.metadata.description;
            console.log(id);
            console.log("You clicked element #" + e.target.metadata.description);
            window.open(
                "./developerProfile/?id=" + id,
                "_blank",
                "toolbar=yes,scrollbars=yes,resizable=yes,top=200,left=200,width=800,height=800"
            );
        }
    </script>

    <script src="/developersOption.js"></script>
</body>

</html>